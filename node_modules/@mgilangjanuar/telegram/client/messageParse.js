"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports._getResponseMessage = exports._parseMessageText = exports._replaceWithMention = exports.DEFAULT_DELIMITERS = void 0;
const Utils_1 = require("../Utils");
const tl_1 = require("../tl");
const index_1 = require("../index");
const Helpers_1 = require("../Helpers");
const big_integer_1 = __importDefault(require("big-integer"));
exports.DEFAULT_DELIMITERS = {
    "**": tl_1.Api.MessageEntityBold,
    __: tl_1.Api.MessageEntityItalic,
    "~~": tl_1.Api.MessageEntityStrike,
    "`": tl_1.Api.MessageEntityCode,
    "```": tl_1.Api.MessageEntityPre,
};
/** @hidden */
async function _replaceWithMention(client, entities, i, user) {
    try {
        entities[i] = new tl_1.Api.InputMessageEntityMentionName({
            offset: entities[i].offset,
            length: entities[i].length,
            userId: (await client.getInputEntity(user)),
        });
        return true;
    }
    catch (e) {
        return false;
    }
}
exports._replaceWithMention = _replaceWithMention;
/** @hidden */
async function _parseMessageText(client, message, parseMode) {
    if (parseMode == false) {
        return [message, []];
    }
    if (parseMode == undefined) {
        if (client.parseMode == undefined) {
            return [message, []];
        }
        parseMode = client.parseMode;
    }
    else if (typeof parseMode === "string") {
        parseMode = (0, Utils_1.sanitizeParseMode)(parseMode);
    }
    const [rawMessage, msgEntities] = parseMode.parse(message);
    for (let i = msgEntities.length - 1; i >= 0; i--) {
        const e = msgEntities[i];
        if (e instanceof tl_1.Api.MessageEntityTextUrl) {
            const m = /^@|\+|tg:\/\/user\?id=(\d+)/.exec(e.url);
            if (m) {
                const userIdOrUsername = m[1] ? Number(m[1]) : e.url;
                const isMention = await _replaceWithMention(client, msgEntities, i, userIdOrUsername);
                if (!isMention) {
                    msgEntities.splice(i, 1);
                }
            }
        }
    }
    return [rawMessage, msgEntities];
}
exports._parseMessageText = _parseMessageText;
/** @hidden */
function _getResponseMessage(client, request, result, inputChat) {
    let updates = [];
    let entities = new Map();
    if (result instanceof tl_1.Api.UpdateShort) {
        updates = [result.update];
    }
    else if (result instanceof tl_1.Api.Updates ||
        result instanceof tl_1.Api.UpdatesCombined) {
        updates = result.updates;
        for (const x of [...result.users, ...result.chats]) {
            entities.set(index_1.utils.getPeerId(x), x);
        }
    }
    else {
        return;
    }
    const randomToId = new Map();
    const idToMessage = new Map();
    const schedToMessage = new Map();
    for (const update of updates) {
        if (update instanceof tl_1.Api.UpdateMessageID) {
            randomToId.set(update.randomId.toString(), update.id);
        }
        else if (update instanceof tl_1.Api.UpdateNewChannelMessage ||
            update instanceof tl_1.Api.UpdateNewMessage) {
            update.message._finishInit(client, entities, inputChat);
            if ("randomId" in request || (0, Helpers_1.isArrayLike)(request)) {
                idToMessage.set(update.message.id, update.message);
            }
            else {
                return update.message;
            }
        }
        else if (update instanceof tl_1.Api.UpdateEditMessage &&
            "peer" in request &&
            (0, Helpers_1._entityType)(request.peer) != Helpers_1._EntityType.CHANNEL) {
            update.message._finishInit(client, entities, inputChat);
            if ("randomId" in request) {
                idToMessage.set(update.message.id, update.message);
            }
            else if ("id" in request && request.id === update.message.id) {
                return update.message;
            }
        }
        else if (update instanceof tl_1.Api.UpdateEditChannelMessage &&
            "peer" in request &&
            (0, Utils_1.getPeerId)(request.peer) ==
                (0, Utils_1.getPeerId)(update.message.peerId)) {
            if (request.id == update.message.id) {
                update.message._finishInit(client, entities, inputChat);
                return update.message;
            }
        }
        else if (update instanceof tl_1.Api.UpdateNewScheduledMessage) {
            update.message._finishInit(client, entities, inputChat);
            schedToMessage.set(update.message.id, update.message);
        }
        else if (update instanceof tl_1.Api.UpdateMessagePoll) {
            if (request.media.poll.id == update.pollId) {
                const m = new tl_1.Api.Message({
                    id: request.id,
                    peerId: index_1.utils.getPeerId(request.peer),
                    media: new tl_1.Api.MessageMediaPoll({
                        poll: update.poll,
                        results: update.results,
                    }),
                    message: "",
                    date: 0,
                });
                m._finishInit(client, entities, inputChat);
                return m;
            }
        }
    }
    if (request == undefined) {
        return idToMessage;
    }
    let mapping;
    let opposite = new Map();
    if ("scheduleDate" in request && request.scheduleDate != undefined) {
        mapping = schedToMessage;
        opposite = idToMessage;
    }
    else {
        mapping = idToMessage;
    }
    let randomId = (0, Helpers_1.isArrayLike)(request) ||
        typeof request == "number" ||
        big_integer_1.default.isInstance(request)
        ? request
        : request.randomId.toString();
    if (!randomId) {
        client._log.warn(`No randomId in ${request} to map to. returning undefined for ${result}`);
        return undefined;
    }
    if (!(0, Helpers_1.isArrayLike)(randomId)) {
        let msg = mapping.get(randomToId.get(randomId));
        if (!msg) {
            msg = opposite.get(randomToId.get(randomId));
        }
        if (!msg) {
            client._log.warn(`Request ${request.className} had missing message mapping ${result.className}`);
        }
        return msg;
    }
    else {
        let arrayRandomId = randomId;
        const mappingToReturn = [];
        let warned = false;
        for (let i = 0; i < arrayRandomId.length; i++) {
            const tempRandom = arrayRandomId[i];
            if (tempRandom == undefined) {
                warned = true;
                break;
            }
            const rnd = tempRandom.toString();
            const msgId = randomToId.get(rnd);
            if (msgId == undefined) {
                warned = true;
                break;
            }
            const msg = mapping.get(msgId);
            if (!msg) {
                warned = true;
                break;
            }
            else {
                mappingToReturn.push(msg);
            }
        }
        if (!warned) {
            return mappingToReturn;
        }
        const oppositeToReturn = [];
        warned = false;
        for (let i = 0; i < randomId.length; i++) {
            const rnd = randomId[i] + "";
            const msg = opposite.get(randomToId.get(rnd));
            if (!msg) {
                client._log.warn(`Request ${request} had missing message mapping ${result}`);
                warned = true;
                break;
            }
            else {
                oppositeToReturn.push(msg);
            }
        }
        if (!warned) {
            return mappingToReturn;
        }
    }
    const finalToReturn = [];
    for (let i = 0; i < randomId.length; i++) {
        const rnd = randomId[i] + "";
        if (randomToId.has(rnd)) {
            finalToReturn.push(mapping.get(randomToId.get(rnd)) ||
                opposite.get(randomToId.get(rnd)));
        }
    }
    return finalToReturn;
}
exports._getResponseMessage = _getResponseMessage;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZVBhcnNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vZ3JhbWpzL2NsaWVudC9tZXNzYWdlUGFyc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsb0NBQXdEO0FBQ3hELDhCQUE0QjtBQUc1QixvQ0FBaUM7QUFDakMsd0NBQW1FO0FBQ25FLDhEQUFpQztBQVFwQixRQUFBLGtCQUFrQixHQUUzQjtJQUNBLElBQUksRUFBRSxRQUFHLENBQUMsaUJBQWlCO0lBQzNCLEVBQUUsRUFBRSxRQUFHLENBQUMsbUJBQW1CO0lBQzNCLElBQUksRUFBRSxRQUFHLENBQUMsbUJBQW1CO0lBQzdCLEdBQUcsRUFBRSxRQUFHLENBQUMsaUJBQWlCO0lBQzFCLEtBQUssRUFBRSxRQUFHLENBQUMsZ0JBQWdCO0NBQzlCLENBQUM7QUFPRixjQUFjO0FBQ1AsS0FBSyxVQUFVLG1CQUFtQixDQUNyQyxNQUFzQixFQUN0QixRQUFpQyxFQUNqQyxDQUFTLEVBQ1QsSUFBZ0I7SUFFaEIsSUFBSTtRQUNBLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLFFBQUcsQ0FBQyw2QkFBNkIsQ0FBQztZQUNoRCxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU07WUFDMUIsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNO1lBQzFCLE1BQU0sRUFBRSxDQUFDLE1BQU0sTUFBTSxDQUFDLGNBQWMsQ0FDaEMsSUFBSSxDQUNQLENBQWlDO1NBQ3JDLENBQUMsQ0FBQztRQUNILE9BQU8sSUFBSSxDQUFDO0tBQ2Y7SUFBQyxPQUFPLENBQUMsRUFBRTtRQUNSLE9BQU8sS0FBSyxDQUFDO0tBQ2hCO0FBQ0wsQ0FBQztBQWxCRCxrREFrQkM7QUFFRCxjQUFjO0FBQ1AsS0FBSyxVQUFVLGlCQUFpQixDQUNuQyxNQUFzQixFQUN0QixPQUFlLEVBQ2YsU0FBMEM7SUFFMUMsSUFBSSxTQUFTLElBQUksS0FBSyxF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